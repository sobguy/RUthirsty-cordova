<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RUthirsty - Automated Tests</title>
    <style>
        body {
            font-family: monospace;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background: #1a202c;
            color: #e2e8f0;
        }
        h1 { color: #667eea; }
        .test-result {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            border-left: 4px solid;
        }
        .pass {
            background: #1a3a1a;
            border-color: #48bb78;
            color: #9ae6b4;
        }
        .fail {
            background: #3a1a1a;
            border-color: #f56565;
            color: #fc8181;
        }
        .info {
            background: #1a2a3a;
            border-color: #4299e1;
            color: #90cdf4;
        }
        #summary {
            background: #2d3748;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #764ba2;
        }
    </style>
</head>
<body>
    <h1>ðŸ§ª RUthirsty - Automated Tests</h1>
    
    <div>
        <button onclick="runAllTests()">Run All Tests</button>
        <button onclick="clearData()">Clear Data</button>
        <button onclick="addTestData()">Add Test Data</button>
        <button onclick="location.href='index.html'">Go to App</button>
    </div>

    <div id="summary"></div>
    <div id="results"></div>

    <script>
        let testResults = [];

        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.textContent = message;
            document.getElementById('results').appendChild(div);
            
            if (type === 'pass') testResults.push(true);
            if (type === 'fail') testResults.push(false);
        }

        function assert(condition, message) {
            if (condition) {
                log(`âœ“ ${message}`, 'pass');
            } else {
                log(`âœ— ${message}`, 'fail');
            }
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
            testResults = [];
        }

        function updateSummary() {
            const total = testResults.length;
            const passed = testResults.filter(r => r).length;
            const failed = total - passed;
            const percentage = total > 0 ? Math.round((passed / total) * 100) : 0;
            
            document.getElementById('summary').innerHTML = `
                <h2>Test Summary</h2>
                <p>Total: ${total} | Passed: ${passed} | Failed: ${failed} | Success Rate: ${percentage}%</p>
            `;
        }

        function clearData() {
            localStorage.removeItem('waterIntakeRecords');
            log('localStorage cleared', 'info');
        }

        function addTestData() {
            const records = [];
            const now = new Date();
            
            for (let i = 0; i < 5; i++) {
                const time = new Date(now.getTime() - (i * 3600000)); // 1 hour apart
                records.push({
                    id: `${time.getTime()}_test${i}`,
                    timestamp: time.getTime(),
                    date: formatDate(time),
                    time: formatTime(time),
                    amount: 250
                });
            }
            
            localStorage.setItem('waterIntakeRecords', JSON.stringify(records));
            log(`Added ${records.length} test records`, 'info');
        }

        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function formatTime(date) {
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            const seconds = String(date.getSeconds()).padStart(2, '0');
            return `${hours}:${minutes}:${seconds}`;
        }

        function runAllTests() {
            clearResults();
            log('Starting test suite...', 'info');
            
            // Test 1: localStorage availability
            log('\n=== Test Suite 1: Storage Tests ===', 'info');
            assert(typeof localStorage !== 'undefined', 'localStorage is available');
            
            // Test 2: Clear and verify empty
            localStorage.removeItem('waterIntakeRecords');
            const empty = localStorage.getItem('waterIntakeRecords');
            assert(empty === null, 'localStorage can be cleared');
            
            // Test 3: Write data
            const testData = [{id: 'test1', amount: 250}];
            localStorage.setItem('waterIntakeRecords', JSON.stringify(testData));
            const stored = localStorage.getItem('waterIntakeRecords');
            assert(stored !== null, 'Data can be written to localStorage');
            
            // Test 4: Read and parse data
            let parsed;
            try {
                parsed = JSON.parse(stored);
                assert(Array.isArray(parsed), 'Stored data is an array');
                assert(parsed.length === 1, 'Array has correct length');
                assert(parsed[0].id === 'test1', 'Data integrity maintained');
            } catch (e) {
                assert(false, 'Data can be parsed from JSON');
            }
            
            // Test 5: Load app scripts
            log('\n=== Test Suite 2: Script Loading ===', 'info');
            
            // Create script elements to test loading
            const scripts = ['dataManager.js', 'uiController.js', 'app.js'];
            let scriptsLoaded = 0;
            
            scripts.forEach(scriptName => {
                const script = document.createElement('script');
                script.src = `js/${scriptName}`;
                script.onload = () => {
                    scriptsLoaded++;
                    log(`âœ“ ${scriptName} loaded`, 'pass');
                    testResults.push(true);
                    
                    if (scriptsLoaded === scripts.length) {
                        continueTests();
                    }
                };
                script.onerror = () => {
                    log(`âœ— ${scriptName} failed to load`, 'fail');
                    testResults.push(false);
                };
                document.head.appendChild(script);
            });
        }

        function continueTests() {
            setTimeout(() => {
                log('\n=== Test Suite 3: DataManager Tests ===', 'info');
                
                // Test DataManager exists
                assert(typeof DataManager !== 'undefined', 'DataManager is defined');
                assert(typeof DataManager.addRecord === 'function', 'DataManager.addRecord exists');
                assert(typeof DataManager.getAllRecords === 'function', 'DataManager.getAllRecords exists');
                assert(typeof DataManager.getTodayRecords === 'function', 'DataManager.getTodayRecords exists');
                assert(typeof DataManager.getTodayTotal === 'function', 'DataManager.getTodayTotal exists');
                
                // Test adding records
                localStorage.removeItem('waterIntakeRecords');
                const record1 = DataManager.addRecord();
                assert(record1 !== null, 'addRecord returns a record');
                assert(record1.amount === 250, 'Record has correct amount');
                assert(typeof record1.id === 'string', 'Record has ID');
                assert(typeof record1.timestamp === 'number', 'Record has timestamp');
                
                // Test getting records
                const allRecords = DataManager.getAllRecords();
                assert(allRecords.length === 1, 'getAllRecords returns correct count');
                
                // Add more records
                DataManager.addRecord();
                DataManager.addRecord();
                const todayRecords = DataManager.getTodayRecords();
                assert(todayRecords.length === 3, 'getTodayRecords returns all today records');
                
                // Test totals
                const total = DataManager.getTodayTotal();
                assert(total.glasses === 3, 'Total glasses calculated correctly');
                assert(total.ml === 750, 'Total ml calculated correctly (3 * 250)');
                
                log('\n=== Test Suite 4: UIController Tests ===', 'info');
                
                // Test UIController exists
                assert(typeof UIController !== 'undefined', 'UIController is defined');
                assert(typeof UIController.init === 'function', 'UIController.init exists');
                assert(typeof UIController.updateDisplay === 'function', 'UIController.updateDisplay exists');
                assert(typeof UIController.renderRecords === 'function', 'UIController.renderRecords exists');
                
                log('\n=== Test Suite 5: Data Format Tests ===', 'info');
                
                // Test date formatting
                const testDate = new Date('2026-02-07T14:30:00');
                const formattedDate = DataManager.formatDate(testDate);
                assert(formattedDate === '2026-02-07', 'Date formatted correctly');
                
                const formattedTime = DataManager.formatTime(testDate);
                assert(formattedTime === '14:30:00', 'Time formatted correctly');
                
                log('\n=== Test Suite 6: Edge Cases ===', 'info');
                
                // Test rapid additions
                localStorage.removeItem('waterIntakeRecords');
                for (let i = 0; i < 10; i++) {
                    DataManager.addRecord();
                }
                const rapidRecords = DataManager.getAllRecords();
                assert(rapidRecords.length === 10, 'Handles rapid record additions');
                
                // Test unique IDs
                const ids = rapidRecords.map(r => r.id);
                const uniqueIds = new Set(ids);
                assert(uniqueIds.size === ids.length, 'All record IDs are unique');
                
                // Test large dataset
                localStorage.removeItem('waterIntakeRecords');
                for (let i = 0; i < 100; i++) {
                    DataManager.addRecord();
                }
                const largeDataset = DataManager.getAllRecords();
                assert(largeDataset.length === 100, 'Handles large datasets (100 records)');
                
                const largeTotal = DataManager.getTodayTotal();
                assert(largeTotal.ml === 25000, 'Calculates large totals correctly (100 * 250)');
                
                // Clean up
                localStorage.removeItem('waterIntakeRecords');
                
                log('\n=== All Tests Complete ===', 'info');
                updateSummary();
            }, 500);
        }

        // Auto-run tests on load
        window.addEventListener('load', () => {
            log('Test page loaded. Click "Run All Tests" to begin.', 'info');
        });
    </script>
</body>
</html>
